#apiVersion: cluster.x-k8s.io/v1alpha3
#kind: Cluster
#metadata:
#  name: test
#  namespace: default
#spec:
#  clusterNetwork:
#    pods:
#      cidrBlocks:
#      - 192.168.0.0/16
#  controlPlaneRef:
#    apiVersion: controlplane.cluster.x-k8s.io/v1alpha3
#    kind: KubeadmControlPlane
#    name: test-control-plane
#  infrastructureRef:
#    apiVersion: infrastructure.cluster.x-k8s.io/v1alpha3
#    kind: AWSCluster
#    name: test
#---
#apiVersion: infrastructure.cluster.x-k8s.io/v1alpha3
#kind: AWSCluster
#metadata:
#  name: test
#  namespace: default
#spec:
#  region: us-east-1
#  sshKeyName: default
#---
#apiVersion: controlplane.cluster.x-k8s.io/v1alpha3
#kind: KubeadmControlPlane
#metadata:
#  name: test-control-plane
#  namespace: default
#spec:
#  infrastructureTemplate:
#    apiVersion: infrastructure.cluster.x-k8s.io/v1alpha3
#    kind: AWSMachineTemplate
#    name: test-control-plane
#  kubeadmConfigSpec:
#    clusterConfiguration:
#      apiServer:
#        extraArgs:
#          cloud-provider: aws
#      controllerManager:
#        extraArgs:
#          cloud-provider: aws
#    initConfiguration:
#      nodeRegistration:
#        kubeletExtraArgs:
#          cloud-provider: aws
#        name: '{{ ds.meta_data.local_hostname }}'
#    joinConfiguration:
#      nodeRegistration:
#        kubeletExtraArgs:
#          cloud-provider: aws
#        name: '{{ ds.meta_data.local_hostname }}'
#  replicas: 1
#  version: v1.16.6
#---
#apiVersion: infrastructure.cluster.x-k8s.io/v1alpha3
#kind: AWSMachineTemplate
#metadata:
#  name: test-control-plane
#  namespace: default
#spec:
#  template:
#    spec:
#      iamInstanceProfile: control-plane.cluster-api-provider-aws.sigs.k8s.io
#      instanceType: t3.large
#      sshKeyName: default
#---
#apiVersion: cluster.x-k8s.io/v1alpha3
#kind: MachineDeployment
#metadata:
#  name: test-md-0
#  namespace: default
#spec:
#  clusterName: test
#  replicas: 0
#  selector:
#    matchLabels: null
#  template:
#    spec:
#      bootstrap:
#        configRef:
#          apiVersion: bootstrap.cluster.x-k8s.io/v1alpha3
#          kind: KubeadmConfigTemplate
#          name: test-md-0
#      clusterName: test
#      infrastructureRef:
#        apiVersion: infrastructure.cluster.x-k8s.io/v1alpha3
#        kind: AWSMachineTemplate
#        name: test-md-0
#      version: v1.16.6
#---
#apiVersion: infrastructure.cluster.x-k8s.io/v1alpha3
#kind: AWSMachineTemplate
#metadata:
#  name: test-md-0
#  namespace: default
#spec:
#  template:
#    spec:
#      iamInstanceProfile: nodes.cluster-api-provider-aws.sigs.k8s.io
#      instanceType: t3.large
#      sshKeyName: default
#---
#apiVersion: bootstrap.cluster.x-k8s.io/v1alpha3
#kind: KubeadmConfigTemplate
#metadata:
#  name: test-md-0
#  namespace: default
#spec:
#  template:
#    spec:
#      joinConfiguration:
#        nodeRegistration:
#          kubeletExtraArgs:
#            cloud-provider: aws
#          name: '{{ ds.meta_data.local_hostname }}'


apiVersion: controlplane.cluster.x-k8s.io/v1alpha3
kind: KubeadmControlPlane
metadata:
  name: test-control-plane
  namespace: default
spec:
  infrastructureTemplate:
    apiVersion: infrastructure.cluster.x-k8s.io/v1alpha3
    kind: AWSMachineTemplate
    name: test-control-plane
  kubeadmConfigSpec:
    clusterConfiguration:
      apiServer:
        extraArgs:
          cloud-provider: aws
      controllerManager:
        extraArgs:
          cloud-provider: aws
    initConfiguration:
      nodeRegistration:
        kubeletExtraArgs:
          cloud-provider: aws
        name: '{{ ds.meta_data.local_hostname }}'
    joinConfiguration:
      nodeRegistration:
        kubeletExtraArgs:
          cloud-provider: aws
        name: '{{ ds.meta_data.local_hostname }}'
  replicas: 1
  version: v1.16.6